import e from"fs";import r from"util";import t from"./Client.js";import o from"../channel/NodeChannel.js";import s from"../channel/NodeMirrorChannel.js";import n from"../LedgerId.js";import i from"../account/AccountId.js";import a from"../address_book/NodeAddressBook.js";import{addressBook as w}from"./addressbooks/mainnet.js";import{addressBook as k}from"./addressbooks/testnet.js";import{addressBook as N}from"./addressbooks/previewnet.js";import{decode as m}from"../encoding/hex.js";import{MirrorNetwork as c}from"../constants/ClientConstants.js";const d=r.promisify(e.readFile),h={LOCAL_NODE:{"127.0.0.1:50211":new i(3)}};class f extends t{constructor(e){if(super(e),this._maxExecutionTime=1e4,null!=e){if("string"==typeof e.network)this._setNetworkFromName(e.network);else if(null!=e.network){t._validateNetworkConsistency(e.network);const{shard:r,realm:o}=t._extractShardRealm(e.network);this._shard=r,this._realm=o,this.setNetwork(e.network)}if("string"==typeof e.mirrorNetwork)switch(e.mirrorNetwork){case"mainnet":this.setMirrorNetwork(c.MAINNET);break;case"testnet":this.setMirrorNetwork(c.TESTNET);break;case"previewnet":this.setMirrorNetwork(c.PREVIEWNET);break;default:this.setMirrorNetwork([e.mirrorNetwork])}else null!=e.mirrorNetwork&&this.setMirrorNetwork(e.mirrorNetwork)}}static fromConfig(e){return new f("string"==typeof e?JSON.parse(e):e)}static async fromConfigFile(e){return f.fromConfig(await d(e,"utf8"))}static forNetwork(e,r){return new f({network:e,...r})}static forName(e,r={}){return new f({network:e,...r})}static forMainnet(e={}){return new f({network:"mainnet",...e})}static forTestnet(e={}){return new f({network:"testnet",...e})}static async forMirrorNetwork(e,r,t){const o=new f({mirrorNetwork:e,shard:r,realm:t});return await o.updateNetwork(),o}static forPreviewnet(e={}){return new f({network:"previewnet",...e})}static forLocalNode(e={scheduleNetworkUpdate:!1}){return new f({network:"local-node",...e})}static async forMainnetAsync(e={}){return new f({network:"mainnet",...e}).updateNetwork()}static async forTestnetAsync(e={}){return new f({network:"testnet",...e}).updateNetwork()}static async forPreviewnetAsync(e={}){return new f({network:"previewnet",...e}).updateNetwork()}static async forNameAsync(e,r={}){const t=new f({network:e,...r});return"local-node"!==e&&await t.updateNetwork(),t}setNetwork(e){"string"==typeof e?this._setNetworkFromName(e):this._network.setNetwork(e)}setMaxExecutionTime(e){return this._maxExecutionTime=e,this}_setNetworkFromName(e){switch(e){case"mainnet":this.setNetworkFromAddressBook(a.fromBytes(m(w))),this.setMirrorNetwork(c.MAINNET),this.setLedgerId(n.MAINNET);break;case"testnet":this.setNetworkFromAddressBook(a.fromBytes(m(k))),this.setMirrorNetwork(c.TESTNET),this.setLedgerId(n.TESTNET);break;case"previewnet":this.setNetworkFromAddressBook(a.fromBytes(m(N))),this.setMirrorNetwork(c.PREVIEWNET),this.setLedgerId(n.PREVIEWNET);break;case"local-node":this.setNetwork(h.LOCAL_NODE),this.setMirrorNetwork(c.LOCAL_NODE),this.setLedgerId(n.LOCAL_NODE);break;default:throw new Error(`unknown network: ${e}`)}return this}setMirrorNetwork(e){if("string"==typeof e)switch(e){case"local-node":this._mirrorNetwork.setNetwork(c.LOCAL_NODE);break;case"previewnet":this._mirrorNetwork.setNetwork(c.PREVIEWNET);break;case"testnet":this._mirrorNetwork.setNetwork(c.TESTNET);break;case"mainnet":this._mirrorNetwork.setNetwork(c.MAINNET);break;default:this._mirrorNetwork.setNetwork([e])}else this._mirrorNetwork.setNetwork(e);return this}_createNetworkChannel(){return e=>new o(e,this._maxExecutionTime)}_createMirrorNetworkChannel(){return e=>new s(e)}}export{h as Network,f as default};
//# sourceMappingURL=NodeClient.js.map
